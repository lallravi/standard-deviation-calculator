<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Standard Deviation Calculator</title>
  <style>
    :root{
      --bg:#f7fafc; --panel:#fff; --text:#0f172a; --muted:#475569;
      --border:#e5e7eb; --accent:#0ea5e9; --shadow:0 8px 24px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .container{max-width:900px;margin:0 auto;padding:24px 16px 96px}
    header{display:grid;justify-items:center;margin:8px 0 20px}
    h1{margin:0;font-size:clamp(1.4rem,2.8vw,2rem);text-align:center}
    .sub{color:var(--muted);text-align:center;margin-top:6px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .stack{display:grid;gap:14px}
    textarea,input,select,button{
      width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);
      background:#fff;color:var(--text);font-size:1rem;outline:none;
      transition:border-color .15s, box-shadow .15s, transform .04s ease;
    }
    textarea{min-height:120px;resize:vertical}
    textarea:focus,input:focus,select:focus{border-color:#bfdbfe;box-shadow:0 0 0 6px rgba(59,130,246,.15)}
    button{background:linear-gradient(180deg,#38bdf8,#0ea5e9);border:none;color:#002c3e;font-weight:700;cursor:pointer;box-shadow:0 10px 24px rgba(14,165,233,.25)}
    button:hover{filter:brightness(1.05)}
    button:active{transform:translateY(1px)}
    .btn-secondary{background:linear-gradient(180deg,#fff,#f3f4f6);color:#111827;border:1px solid var(--border);box-shadow:none}
    .row{display:grid;gap:12px}
    @media(min-width:720px){.row-2{grid-template-columns:1fr 1fr;align-items:end}}
    .hidden{display:none !important}
    .right{text-align:right}
    .muted{color:var(--muted)}
    .small{font-size:.95rem}
    .error{color:#b91c1c}
    .data-grid{width:100%;border-collapse:collapse;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:#fff}
    .data-grid th,.data-grid td{padding:10px 12px;border-bottom:1px solid var(--border);text-align:right;font-variant-numeric:tabular-nums}
    .data-grid th{text-align:left;background:#f3f4f6}
    .data-grid tr:last-child td{border-bottom:none}
    .eqn{
      border-left:4px solid #c7d2fe;background:#f8fafc;border-radius:12px;padding:16px 14px;overflow-x:auto;
      font-family:ui-monospace,Menlo,Consolas,monospace;line-height:1.6;color:#0f172a
    }
    .eqn .formula{font-size:clamp(1.25rem,2.4vw + .6rem,2rem);font-weight:700;display:block;margin:6px 0}
    .eqn .subformula{font-size:clamp(1.05rem,1.6vw + .4rem,1.5rem);font-weight:500;color:#334155;display:block;margin:4px 0}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#fff}
    .center{text-align:center}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Standard Deviation Calculator</h1>
      <div class="sub">Enter numbers separated by commas. Uses sample SD (n − 1) only.</div>
    </header>

    <section class="card" id="step1">
      <div class="stack">
        <label for="data"><strong>Data (comma-separated)</strong></label>
        <textarea id="data" placeholder="Example: 12, 15, 18, 20"></textarea>
        <div class="row row-2">
          <div>
            <label class="small muted" for="precision">Decimals</label>
            <input id="precision" type="number" min="0" max="12" step="1" value="4" />
          </div>
          <div>
            <label class="small muted" for="dtype">Deviation type</label>
            <select id="dtype" aria-label="Deviation type" disabled>
              <option value="sample" selected>Sample SD (n − 1)</option>
            </select>
          </div>
        </div>
        <div class="toolbar">
          <button id="btnClean" type="button" class="btn-secondary">Clean & parse</button>
          <button id="btnCalc" type="button">Calculate</button>
        </div>
        <div id="err1" class="error hidden" role="alert"></div>
      </div>
    </section>

    <!-- Results appear only after Calculate is clicked -->
    <section class="card hidden" id="results">
      <div class="stack">
        <div class="row row-2">
          <div><strong>Results</strong></div>
          <div class="right">
            <span class="pill small">n = <span id="n"></span></span>
            <span class="pill small">Type: Sample (n − 1)</span>
          </div>
        </div>

        <div class="eqn">
          <span class="formula" id="meanEqn1"></span>
          <span class="subformula" id="meanEqn2"></span>
          <span class="subformula" id="meanEqn3"></span>
        </div>

        <div class="eqn">
          <span class="formula" id="sdEqn1"></span>
          <span class="subformula" id="sdEqn2"></span>
          <span class="subformula" id="sdEqn3"></span>
          <span class="subformula" id="sdEqn4"></span>
        </div>

        <div class="center">
          <button id="btnShowTable" type="button" class="btn-secondary">Show calculation table</button>
        </div>

        <div id="tableWrap" class="hidden">
          <div class="small muted">Detailed calculations</div>
          <div style="overflow-x:auto">
            <table class="data-grid mono" id="calcTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th class="right">xᵢ</th>
                  <th class="right">xᵢ − x̄</th>
                  <th class="right">(xᵢ − x̄)²</th>
                </tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr><td colspan="3"><strong>Σ (xᵢ − x̄)²</strong></td><td class="right" id="sumSq"></td></tr>
                <tr><td colspan="3"><strong>Variance s²</strong></td><td class="right" id="variance"></td></tr>
                <tr><td colspan="3"><strong>Standard deviation s</strong></td><td class="right" id="sd"></td></tr>
              </tfoot>
            </table>
          </div>
        </div>

        <div class="toolbar">
          <button id="btnReset" type="button" class="btn-secondary">Start over</button>
        </div>
      </div>
    </section>
  </div>

  <script>
    // State
    let DATA = [];
    let PREC = 4;

    const el = id => document.getElementById(id);

    function parseNumbers(text){
      // Only commas as separators; ignore other whitespace politely
      const tokens = text.split(',').map(t => t.trim()).filter(Boolean);
      const nums = [], bad = [];
      for(const t of tokens){
        const v = Number(t);
        if(Number.isFinite(v)) nums.push(v); else bad.push(t);
      }
      return { nums, bad };
    }

    function sum(a){ return a.reduce((x,y)=>x+y,0); }
    function mean(a){ return a.length ? sum(a)/a.length : NaN; }

    function fmt(x, p = PREC){
      if(!Number.isFinite(x)) return String(x);
      const abs = Math.abs(x);
      const useExp = abs !== 0 && (abs >= 1e9 || abs < 1e-6);
      return useExp ? x.toExponential(p)
        : x.toLocaleString(undefined,{maximumFractionDigits:p, minimumFractionDigits:0});
    }

    function computeSampleStats(arr){
      const m = mean(arr);
      const diffs = arr.map(v => v - m);
      const sq = diffs.map(d => d*d);
      const ss = sum(sq);
      const n = arr.length;
      const variance = n > 1 ? ss / (n - 1) : NaN;
      const sd = Math.sqrt(variance);
      return { n, m, diffs, sq, ss, variance, sd };
    }

    function showResults(){
      const { n, m, ss, variance, sd } = computeSampleStats(DATA);

      el('n').textContent = String(n);

      // Mean equations
      const numer = DATA.map(v => fmt(v)).join(' + ');
      el('meanEqn1').textContent = 'x̄ = (x₁ + x₂ + ⋯ + xₙ) / n';
      el('meanEqn2').textContent = `x̄ = ( ${numer} ) / ${n}`;
      el('meanEqn3').textContent = `x̄ = ${fmt(sum(DATA))} / ${n} = ${fmt(m)}`;

      // SD equations (sample, n − 1)
      el('sdEqn1').textContent = 's² = Σ(xᵢ − x̄)² / (n − 1),   s = √(s²)';
      const parts = DATA.map(v => `(${fmt(v)} − ${fmt(m)})²`).join(' + ');
      el('sdEqn2').textContent = `s² = [ ${parts} ] / (${n} − 1)`;
      el('sdEqn3').textContent = `s² = ${fmt(ss)} / ${n - 1} = ${fmt(variance)}`;
      el('sdEqn4').textContent = `s = √(${fmt(variance)}) = ${fmt(sd)}`;

      el('results').classList.remove('hidden');
      el('tableWrap').classList.add('hidden'); // hidden until user clicks
    }

    function fillTable(){
      const { n, m, diffs, sq, ss, variance, sd } = computeSampleStats(DATA);
      const tbody = el('calcTable').querySelector('tbody');
      tbody.innerHTML = '';
      DATA.forEach((x,i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td class="right">${fmt(x)}</td>
          <td class="right">${fmt(diffs[i])}</td>
          <td class="right">${fmt(sq[i])}</td>
        `;
        tbody.appendChild(tr);
      });
      el('sumSq').textContent = fmt(ss);
      el('variance').textContent = fmt(variance);
      el('sd').textContent = fmt(sd);
    }

    // Events
    el('btnClean').addEventListener('click', () => {
      const { nums, bad } = parseNumbers(el('data').value);
      el('err1').classList.add('hidden');
      el('data').value = nums.join(', ');
      if(bad.length){
        el('err1').textContent = `Ignored non-numeric tokens: ${bad.join(', ')}`;
        el('err1').classList.remove('hidden');
      }
    });

    el('btnCalc').addEventListener('click', () => {
      const { nums } = parseNumbers(el('data').value);
      el('err1').classList.add('hidden');

      PREC = Math.max(0, Math.min(12, Number(el('precision').value || 4)));

      if(nums.length < 2){
        el('err1').textContent = 'Enter at least 2 numeric values (comma-separated).';
        el('err1').classList.remove('hidden');
        return;
      }
      DATA = nums;
      showResults();
    });

    el('btnShowTable').addEventListener('click', () => {
      fillTable();
      el('tableWrap').classList.remove('hidden');
    });

    el('btnReset').addEventListener('click', () => {
      DATA = [];
      el('data').value = '';
      el('results').classList.add('hidden');
      el('err1').classList.add('hidden');
    });

    document.getElementById('precision').addEventListener('change', () => {
      const v = Number(document.getElementById('precision').value || 4);
      PREC = Math.max(0, Math.min(12, v));
      document.getElementById('precision').value = String(PREC);
    });
  </script>
</body>
</html>
